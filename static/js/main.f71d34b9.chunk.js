(this.webpackJsonpwarlords_copy_cat=this.webpackJsonpwarlords_copy_cat||[]).push([[0],{1495:function(t,e,n){"use strict";n.r(e);var r=n(129),a=n.n(r),i=n(563),o=n.n(i),c=(n(571),n(572),n(32)),u=n.n(c),s=n(75),l=n(105),d=n(107),h=n(106),f=n(171),y=n(108),m=102,p=102,b=10,g=2,v=8772,O="minimap",j=function(t){function e(){var t;return Object(s.a)(this,e),t=Object(d.a)(this,Object(h.a)(e).call(this,"UIScene")),c.Scene.call(Object(f.a)(t),{key:"UI",active:!1}),t}return Object(y.a)(e,t),Object(l.a)(e,[{key:"create",value:function(){var t=this.scene.get("GameScene");!function(t,e,n){var r=m,a=p,i=b,o=O,c=v,u=(a-g)/n,s={x:e/2,y:n/2},l={x:t.width-r-i,y:i};t.cameras.add(l.x,l.y,r,a).setZoom(u).setName(o).centerOn(s.x,s.y).setBackgroundColor(c)}(t,t.terrainLayer.width,t.terrainLayer.height);var e=t.players[0],n=this.add.text(20,20,"Current Player: ".concat(e.name(),", turn: ").concat(e.turn()),{fill:"#000000"});this.add.text(700,560,"End Turn",{fill:"#000000"}).setInteractive().on("pointerdown",(function(){t.target=null,t.movement.clear(),e.endTurn(),n.setText("Current Player: ".concat(e.name(),", turn: ").concat(e.turn()))}))}}]),e}(c.Scene),x=n(41),w=n(564),k=n(16),C=n(46),T=[2],M=[4,5,6],S=[8,9,10,11,12,13,14,15],P=[16,17,24,25],I=[1],A=[3,7],E=function(t){function e(){return Object(s.a)(this,e),Object(d.a)(this,Object(h.a)(e).apply(this,arguments))}return Object(y.a)(e,t),Object(l.a)(e,[{key:"createMapControls",value:function(){var t=c.Input.Keyboard.KeyCodes,e=t.Q,n=t.E,r=c.Cameras.Controls.SmoothedKeyControl,a=this.input.keyboard.createCursorKeys(),i=a.left,o=a.right,u={up:a.up,down:a.down,left:i,right:o,camera:this.camera,zoomIn:this.keyboard.addKey(e),zoomOut:this.keyboard.addKey(n),drag:.6,maxSpeed:200,acceleration:2.8};this.controls=new r(u)}},{key:"setupCamera",value:function(t,e){var n=this.camera,r=n.width,a=n.height;this.camera.setBounds(0,0,t,e),this.camera.setScroll(-r/2+t/2,-a/2+e/2)}},{key:"controls",get:function(){return this.mapControls},set:function(t){this.mapControls=t}},{key:"camera",get:function(){return this.cameras.main}},{key:"keyboard",get:function(){return this.input.keyboard}},{key:"width",get:function(){return this.game.config.width}},{key:"height",get:function(){return this.game.config.height}},{key:"finder",get:function(){return this.pathFinder},set:function(t){this.pathFinder=t}},{key:"movement",get:function(){return this.entityMover},set:function(t){this.entityMover=t}},{key:"minimap",get:function(){return this.minimapCamera},set:function(t){this.minimapCamera=t}},{key:"target",get:function(){return this.selectedTarget},set:function(t){this.selectedTarget=t}},{key:"terrainLayer",get:function(){return this.terrain},set:function(t){this.terrain=t}}]),e}(c.Scene),L=n(565),B=n.n(L),D=n(76),z={path:[],cost:0,totalCost:0,currentTurn:[],nextTurns:[],indicators:[],nextIndicators:[]},G=function(t,e,n,r){var a=t.add.graphics(),i=z,o=function(t){return t*n},u=function(t){return t*r},s=function(){a.destroy(),a=t.add.graphics(),i=z},l=function(t){var e=t.x,i=t.y,s={x:o(e)+n/2,y:u(i)+r/2},l=new c.Geom.Circle(s.x,s.y,8);return a.fillCircleShape(l),l},d=function(e){return function(){t.camera.stopFollow(e.body),s()}};return{move:function(n){return function(r){if(!r||r.length<=1)return s();if(i&&i.currentTurn.length&&Object(k.isEqual)(i.path,r))return function(e){var n=i,r=n.cost,a=n.currentTurn.map((function(t){var n=t.x,r=t.y;return{targets:e.body,x:{value:o(n),duration:200},y:{value:u(r),duration:200}}}));t.camera.startFollow(e.body),t.tweens.timeline({tweens:a,onComplete:d(e)}),e.spendMovement(r)}(n);s();var c=r.slice(1,r.length).reduce(function(t,e){return function(n,r){var a=r.x,i=r.y,o=n.cost,c=n.totalCost,u=n.currentTurn,s=n.nextTurns,l=t[i][a];return c+l<=e.movementPoints?Object(D.a)({},n,{cost:o+l,totalCost:c+l,currentTurn:[].concat(Object(x.a)(u),[{x:a,y:i}])}):Object(D.a)({},n,{nextTurns:[].concat(Object(x.a)(s),[{x:a,y:i}])})}}(e,n),Object(D.a)({},z,{path:r})),h=c.currentTurn,f=c.nextTurns;a.fillStyle(16777215,1),c.indicators=h.map(l),a.fillStyle(16711680,1),c.nextIndicators=f.map(l),i=c}},clear:s}},K=function t(e,n,r,a){var i=this;Object(s.a)(this,t),this.spendMovement=function(t){return i.movementPoints-=t},this.resetMovement=function(){return i.movementPoints=4},this.update=function(){var t=i.body.body;t.embedded&&(t.touching.none=!1);var e=!t.touching.none,n=!t.wasTouching.none;e&&!n?i.body.emit("overlapstart"):!e&&n&&i.body.emit("overlapend")},this.scene=e,this.movementPoints=4,this.body=e.physics.add.sprite(n,r,a).setDisplaySize(64,64).setDisplayOrigin(-16,-10).setInteractive().on("pointerdown",(function(){return e.target=i})),this.onCastle=!1,this.body.on("overlapstart",(function(){this.body.debugBodyColor=16724736,this.onCastle=!0,alert("You're on a castle")})),this.body.on("overlapend",(function(){this.body.debugBodyColor=65331,this.onCastle=!1})),this.scene.triggers.forEach((function(t){i.scene.physics.add.overlap(i.body,t)}))},U={turn:1,name:"",money:0,armies:[],castles:[]},F=function(t,e){var n=Object(D.a)({},U,{name:"Player ".concat(e)});return{state:n,name:function(){return n.name},turn:function(){return n.turn},update:function(){return n.armies.forEach((function(t){return t.update()}))},endTurn:function(){n.armies.forEach((function(t){return t.resetMovement()})),n=Object(D.a)({},n,{turn:n.turn+1})},addArmy:function(e,r,a){var i=new K(t,e,r,a);return n=Object(D.a)({},n,{armies:[].concat(Object(x.a)(n.armies),[i])}),i}}},_=function(t,e){return{x:Math.floor(t/128),y:Math.floor(e/128)}},H=function(t){function e(){var t;return Object(s.a)(this,e),(t=Object(d.a)(this,Object(h.a)(e).call(this,"GameScene"))).onPointerDown=function(e){var n=e.worldX,r=e.worldY;if(t.target){var a=_(n,r),i=_(t.target.body.x,t.target.body.y),o=t.movement.move(t.target);try{t.finder.findPath(i.x,i.y,a.x,a.y,o),t.finder.calculate()}catch(c){console.error("Ups! Out of scope :S")}}},t.players=[],t}return Object(y.a)(e,t),Object(l.a)(e,[{key:"addPlayer",value:function(){var t=this.players.length,e=F(this,t);return this.players.push(e),e}},{key:"preload",value:function(){this.load.setBaseURL("".concat("/warlords-copy-cat")),this.load.image("tileset","tilesets/tileset-extruded.png"),this.load.image("warrior","warrior.png")}},{key:"create",value:function(){var t=function(t,e,n,r){var a,i=t.make.tilemap({tileWidth:128,tileHeight:128}),o=i.tileWidth,c=i.tileHeight,u=i.addTilesetImage("tileset","tileset",o,c,1,2),s=i.createBlankDynamicLayer("terrain",u,0,0,n,r),l=i.createBlankDynamicLayer("object",u,0,0,n,r),d=new B.a.js;d.setGrid(e),d.setAcceptableTiles([].concat(Object(x.a)(T),Object(x.a)(I),Object(x.a)(M))),d.enableDiagonals();var h=[],f=function(t,e){return function(n,r,a,i){e.setTileCost(n,i),t[a]=t[a]||[],t[a][r]=i}}(h,d);return t.triggers=[],e.forEach((function(e,n){return e.forEach((function(e,r){if(!a&&Object(k.includes)(P,e)&&(a={x:r,y:n}),Object(k.includes)(P,e)){if(s.putTileAt(T[0],r,n),l.putTileAt(e,r,n),e===P[0]){var i=t.add.zone(r*o+o,n*o+c).setSize(2*o+64,2*c+64);t.physics.world.enable(i),i.body.setAllowGravity(!1),i.body.moves=!1,t.triggers.push(i)}}else s.putTileAt(e,r,n);Object(k.includes)(T,e)&&f(e,r,n,1),Object(k.includes)(M,e)&&f(e,r,n,2),Object(k.includes)(I,e)&&f(e,r,n,3)}))})),s=i.convertLayerToStatic(s),(l=i.convertLayerToStatic(l)).setTileIndexCallback(24,(function(){return console.log("here 24")}),t),l.setTileIndexCallback(25,(function(){return console.log("here 25")}),t),t.objectLayer=l,{map:i,finder:d,costMatrix:h,spawnPoint:a,terrainLayer:s}}(this,function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.random(),r=new w.Noise;r.seed(n);var a=12*t/100,i=0,o=0,c=0,u=0,s=Object(k.range)(e).map((function(e){return Object(k.range)(t).map((function(t){var n=r.perlin2(t/a,e/a);return i=n<i?n:i,o=n>o?n:o,n<0?c++:u++,n}))})),l=.45,d=l+.1,h=function(t){return t>=l&&t<d},f=function(t){return t<l},y=function(t){return!h(t)&&!f(t)},m=function(t,e,n){if(n-1<0||n+1>=t.length)return Object(k.sample)(A);if(e-1<0||e+1>=t.length)return Object(k.sample)(A);var r=Object(C.a)(i,o,t[n-1][e-1]),a=Object(C.a)(i,o,t[n-1][e]),c=Object(C.a)(i,o,t[n-1][e+1]),u=Object(C.a)(i,o,t[n][e-1]),s=Object(C.a)(i,o,t[n][e+1]),d=Object(C.a)(i,o,t[n+1][e-1]),h=Object(C.a)(i,o,t[n+1][e]),f=Object(C.a)(i,o,t[n+1][e+1]);return y(a)||y(u)||y(s)||y(h)?y(h)&&y(s)?S[7]:y(a)&&y(s)?S[2]:y(h)&&y(u)?S[5]:y(a)&&y(u)?S[0]:y(a)?S[1]:y(h)?S[6]:y(s)?S[3]:y(u)?S[4]:r<l&&a<l&&c<l?S[6]:d<l&&h<l&&f<l?S[1]:void 0:Object(k.sample)(A)},p=function(t){return function(e,n,r){var a=Object(C.a)(i,o,e);return f(a)?Object(k.sample)(A):h(a)?m(t,n,r):a>=.7&&a<.8?Object(k.sample)(M):a>=.8?Object(k.sample)(I):Object(k.sample)(T)}},b=p(s),g=s.map((function(t,e){return t.map((function(t,n){return b(t,n,e)}))})),v=function(t){var e=t.x,n=t.y;if(n-1<0||e-1<0)return!1;var r=g[n-1][e-1],a=g[n-1][e],i=g[n][e-1],o=g[n][e],c=function(t){return Object(k.includes)(T,t)};return c(r)&&c(a)&&c(i)&&c(o)},O=g.flatMap((function(t,e){return t.map((function(t,n){return{x:n,y:e}}))})).filter(v),j=function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},E=function(t){var e=t.x,n=t.y;return g[n-1][e-1]=P[0],g[n-1][e]=P[1],g[n][e-1]=P[2],g[n][e]=P[3],{x:e,y:n}},L=function(t,e,n){return Object(k.every)(t,(function(t){return j(t,e)>n}))},B=function(t){return function(e,n){for(var r=Object(k.sample)(O),a=L(e,r,t);!a;)r=Object(k.sample)(O),a=L(e,r,t);return[].concat(Object(x.a)(e),[r])}},D=function(){var t=Object(k.range)(20).reduce(B(20),[]).map(E);return console.log(t.length),console.log(t),t};return D(),console.log("Min: ".concat(i,", Max: ").concat(o)),console.log("<0: ".concat(c,", >0: ").concat(u)),console.log("Seed: ".concat(n)),g}(100,100),100,100),e=t.map,n=t.finder,r=t.costMatrix,a=t.spawnPoint,i=t.terrainLayer;this.finder=n,this.terrainLayer=i;var o,c,u=e.tileWidth,s=e.tileHeight,l=(o=a.x-2,c=a.y+2,{x:Math.floor(128*o),y:Math.floor(128*c)}),d=this.addPlayer();this.target=d.addArmy(l.x,l.y,"warrior"),this.setupCamera(i.width,i.height),this.camera.centerOn(l.x,l.y),this.movement=G(this,r,u,s),this.createMapControls(),this.input.on("pointerdown",this.onPointerDown),this.scene.run("UI")}},{key:"update",value:function(t,e){this.controls.update(e),this.camera.setZoom(c.Math.Clamp(this.camera.zoom,.08,1)),this.players.forEach((function(t){return t.update()}))}}]),e}(E),N={physics:{default:"arcade",arcade:{debug:!0,gravity:{y:0}}},type:u.a.AUTO,width:800,height:600,parent:"App",pixelArt:!0,scene:[H,j]};new c.Game(N);var W=function(){return a.a.createElement("div",{className:"App",id:"App"})};o.a.render(a.a.createElement(W,null),document.getElementById("root"))},566:function(t,e,n){t.exports=n(1495)},571:function(t,e,n){},572:function(t,e,n){}},[[566,1,2]]]);
//# sourceMappingURL=main.f71d34b9.chunk.js.map
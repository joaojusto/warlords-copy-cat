(this.webpackJsonpwarlords_copy_cat=this.webpackJsonpwarlords_copy_cat||[]).push([[0],{1495:function(t,e,n){"use strict";n.r(e);var r=n(129),a=n.n(r),o=n(563),i=n.n(o),c=(n(571),n(572),n(32)),u=n.n(c),s=n(75),l=n(105),h=n(107),f=n(106),d=n(171),p=n(108),y=102,m=102,b=10,v=2,g=8772,O="minimap",j=function(t){function e(){var t;return Object(s.a)(this,e),t=Object(h.a)(this,Object(f.a)(e).call(this,"UIScene")),c.Scene.call(Object(d.a)(t),{key:"UI",active:!1}),t}return Object(p.a)(e,t),Object(l.a)(e,[{key:"create",value:function(){var t=this.scene.get("GameScene");!function(t,e,n){var r=y,a=m,o=b,i=O,c=g,u=(a-v)/n,s={x:e/2,y:n/2},l={x:t.width-r-o,y:o};t.cameras.add(l.x,l.y,r,a).setZoom(u).setName(i).centerOn(s.x,s.y).setBackgroundColor(c)}(t,t.terrainLayer.width,t.terrainLayer.height);var e=t.players[0],n=this.add.text(20,20,"Current Player: ".concat(e.name(),", turn: ").concat(e.turn()),{fill:"#000000"});this.add.text(700,560,"End Turn",{fill:"#000000"}).setInteractive().on("pointerdown",(function(){t.target=null,t.movement.clear(),e.endTurn(),n.setText("Current Player: ".concat(e.name(),", turn: ").concat(e.turn()))})).on("pointerover",(function(){return t.setClickCursor()})).on("pointerout",(function(){return t.setDefaultCursor()}))}}]),e}(c.Scene),C=n(41),x=n(564),w=n(16),k=n(46),T=[2],M=[4,5,6],D=[8,9,10,11,12,13,14,15],S=[16,17,24,25],I=[1],P=[3,7],A=function(t){function e(){return Object(s.a)(this,e),Object(h.a)(this,Object(f.a)(e).apply(this,arguments))}return Object(p.a)(e,t),Object(l.a)(e,[{key:"createMapControls",value:function(){var t=c.Input.Keyboard.KeyCodes,e=t.Q,n=t.E,r=c.Cameras.Controls.SmoothedKeyControl,a=this.input.keyboard.createCursorKeys(),o=a.left,i=a.right,u={up:a.up,down:a.down,left:o,right:i,camera:this.camera,zoomIn:this.keyboard.addKey(e),zoomOut:this.keyboard.addKey(n),drag:.6,maxSpeed:200,acceleration:2.8};this.controls=new r(u)}},{key:"setupCamera",value:function(t,e){var n=this.camera,r=n.width,a=n.height;this.camera.setBounds(0,0,t,e),this.camera.setScroll(-r/2+t/2,-a/2+e/2)}},{key:"controls",get:function(){return this.mapControls},set:function(t){this.mapControls=t}},{key:"camera",get:function(){return this.cameras.main}},{key:"keyboard",get:function(){return this.input.keyboard}},{key:"width",get:function(){return this.game.config.width}},{key:"height",get:function(){return this.game.config.height}},{key:"finder",get:function(){return this.pathFinder},set:function(t){this.pathFinder=t}},{key:"movement",get:function(){return this.entityMover},set:function(t){this.entityMover=t}},{key:"minimap",get:function(){return this.minimapCamera},set:function(t){this.minimapCamera=t}},{key:"terrainLayer",get:function(){return this.terrain},set:function(t){this.terrain=t}}]),e}(c.Scene),E=n(565),L=n.n(E),B=n(76),_={path:[],cost:0,totalCost:0,currentTurn:[],nextTurns:[],indicators:[],nextIndicators:[]},z=function(t,e,n,r){var a=t.add.graphics(),o=_,i=function(t){return t*n},u=function(t){return t*r},s=function(){a.destroy(),a=t.add.graphics(),o=_},l=function(t){var e=t.x,o=t.y,s={x:i(e)+n/2,y:u(o)+r/2},l=new c.Geom.Circle(s.x,s.y,8);return a.fillCircleShape(l),l},h=function(e){return function(){t.camera.stopFollow(e.body),s()}};return{move:function(n){return function(r){if(!r||r.length<=1)return s();if(o&&o.currentTurn.length&&Object(w.isEqual)(o.path,r))return function(e){var n=o,r=n.cost,a=n.currentTurn.map((function(t){var n=t.x,r=t.y;return{targets:e.body,x:{value:i(n),duration:200},y:{value:u(r),duration:200}}}));t.camera.startFollow(e.body),t.tweens.timeline({tweens:a,onComplete:h(e)}),e.spendMovement(r)}(n);s();var c=r.slice(1,r.length).reduce(function(t,e){return function(n,r){var a=r.x,o=r.y,i=n.cost,c=n.totalCost,u=n.currentTurn,s=n.nextTurns,l=t[o][a];return c+l<=e.movementPoints?Object(B.a)({},n,{cost:i+l,totalCost:c+l,currentTurn:[].concat(Object(C.a)(u),[{x:a,y:o}])}):Object(B.a)({},n,{nextTurns:[].concat(Object(C.a)(s),[{x:a,y:o}])})}}(e,n),Object(B.a)({},_,{path:r})),f=c.currentTurn,d=c.nextTurns;a.fillStyle(16777215,1),c.indicators=f.map(l),a.fillStyle(16711680,1),c.nextIndicators=d.map(l),o=c}},clear:s}},G=function t(e,n,r,a){var o=this;Object(s.a)(this,t),this.spendMovement=function(t){return o.movementPoints-=t},this.resetMovement=function(){return o.movementPoints=4},this.update=function(){var t=o.body.body;t.embedded&&(t.touching.none=!1);var e=!t.touching.none,n=!t.wasTouching.none;e&&!n?o.body.emit("overlapstart"):!e&&n&&o.body.emit("overlapend")},this.scene=e,this.movementPoints=4,this.body=e.physics.add.sprite(n,r,a).setDisplaySize(64,64).setDisplayOrigin(-16,-10).setInteractive().on("pointerdown",(function(){return e.target=o})),this.onCastle=!1,this.body.on("overlapstart",(function(){this.body.debugBodyColor=16724736,this.onCastle=!0,alert("You're on a castle")})),this.body.on("overlapend",(function(){this.body.debugBodyColor=65331,this.onCastle=!1})),this.scene.triggers.forEach((function(t){o.scene.physics.add.overlap(o.body,t)}))},K={turn:1,name:"",money:0,armies:[],castles:[]},U=function(t,e){var n=Object(B.a)({},K,{name:"Player ".concat(e)});return{state:n,name:function(){return n.name},turn:function(){return n.turn},update:function(){return n.armies.forEach((function(t){return t.update()}))},endTurn:function(){n.armies.forEach((function(t){return t.resetMovement()})),n=Object(B.a)({},n,{turn:n.turn+1})},addArmy:function(e,r,a){var o=new G(t,e,r,a);return n=Object(B.a)({},n,{armies:[].concat(Object(C.a)(n.armies),[o])}),o}}},F=function(t,e){return{x:Math.floor(t/128),y:Math.floor(e/128)}},H=function(t){return"url(".concat("/warlords-copy-cat","/").concat(t,".png), pointer")},N=function(t){function e(){var t;return Object(s.a)(this,e),(t=Object(h.a)(this,Object(f.a)(e).call(this,"GameScene"))).onPointerDown=function(e){if(e.rightButtonDown()&&(t.target=null),t.target){var n=e.worldX,r=e.worldY,a=F(n,r),o=F(t.target.body.x,t.target.body.y),i=t.movement.move(t.target);try{t.finder.findPath(o.x,o.y,a.x,a.y,i),t.finder.calculate()}catch(c){console.error("Ups! Out of scope :S")}}},t.players=[],t}return Object(p.a)(e,t),Object(l.a)(e,[{key:"setClickCursor",value:function(){this.input.setDefaultCursor(H("cursor"))}},{key:"setOpenCursor",value:function(){this.input.setDefaultCursor(H("cursor_open"))}},{key:"setDefaultCursor",value:function(){this.target?this.input.setDefaultCursor(H("cursor_move")):this.input.setDefaultCursor(H("cursor"))}},{key:"addPlayer",value:function(){var t=this.players.length,e=U(this,t);return this.players.push(e),e}},{key:"preload",value:function(){this.load.setBaseURL("".concat("/warlords-copy-cat")),this.load.image("tileset","tilesets/tileset-extruded.png"),this.load.image("warrior","warrior.png")}},{key:"create",value:function(){this.input.setDefaultCursor(H("cursor")),this.input.mouse.disableContextMenu();var t=function(t,e,n,r){var a,o=t.make.tilemap({tileWidth:128,tileHeight:128}),i=o.tileWidth,c=o.tileHeight,u=o.addTilesetImage("tileset","tileset",i,c,1,2),s=o.createBlankDynamicLayer("terrain",u,0,0,n,r),l=o.createBlankDynamicLayer("object",u,0,0,n,r),h=new L.a.js;h.setGrid(e),h.setAcceptableTiles([].concat(Object(C.a)(T),Object(C.a)(I),Object(C.a)(M))),h.enableDiagonals();var f=[],d=function(t,e){return function(n,r,a,o){e.setTileCost(n,o),t[a]=t[a]||[],t[a][r]=o}}(f,h);return t.triggers=[],e.forEach((function(e,n){return e.forEach((function(e,r){if(!a&&Object(w.includes)(S,e)&&(a={x:r,y:n}),Object(w.includes)(S,e)){if(s.putTileAt(T[0],r,n),l.putTileAt(e,r,n),e===S[0]){var o=t.add.zone(r*i+i,n*i+c).setSize(2*i+64,2*c+64);t.physics.world.enable(o),o.body.setAllowGravity(!1),o.body.moves=!1,o.setInteractive(),t.triggers.push(o),o.on("pointerover",(function(){return t.setOpenCursor()})),o.on("pointerout",(function(){return t.setDefaultCursor()}))}}else s.putTileAt(e,r,n);Object(w.includes)(T,e)&&d(e,r,n,1),Object(w.includes)(M,e)&&d(e,r,n,2),Object(w.includes)(I,e)&&d(e,r,n,3)}))})),s=o.convertLayerToStatic(s),(l=o.convertLayerToStatic(l)).setTileIndexCallback(24,(function(){return console.log("here 24")}),t),l.setTileIndexCallback(25,(function(){return console.log("here 25")}),t),t.objectLayer=l,{map:o,finder:h,costMatrix:f,spawnPoint:a,terrainLayer:s}}(this,function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.random(),r=new x.Noise;r.seed(n);var a=12*t/100,o=0,i=0,c=0,u=0,s=Object(w.range)(e).map((function(e){return Object(w.range)(t).map((function(t){var n=r.perlin2(t/a,e/a);return o=n<o?n:o,i=n>i?n:i,n<0?c++:u++,n}))})),l=.45,h=l+.1,f=function(t){return t>=l&&t<h},d=function(t){return t<l},p=function(t){return!f(t)&&!d(t)},y=function(t,e,n){if(n-1<0||n+1>=t.length)return Object(w.sample)(P);if(e-1<0||e+1>=t.length)return Object(w.sample)(P);var r=Object(k.a)(o,i,t[n-1][e-1]),a=Object(k.a)(o,i,t[n-1][e]),c=Object(k.a)(o,i,t[n-1][e+1]),u=Object(k.a)(o,i,t[n][e-1]),s=Object(k.a)(o,i,t[n][e+1]),h=Object(k.a)(o,i,t[n+1][e-1]),f=Object(k.a)(o,i,t[n+1][e]),d=Object(k.a)(o,i,t[n+1][e+1]);return p(a)||p(u)||p(s)||p(f)?p(f)&&p(s)?D[7]:p(a)&&p(s)?D[2]:p(f)&&p(u)?D[5]:p(a)&&p(u)?D[0]:p(a)?D[1]:p(f)?D[6]:p(s)?D[3]:p(u)?D[4]:r<l&&a<l&&c<l?D[6]:h<l&&f<l&&d<l?D[1]:void 0:Object(w.sample)(P)},m=function(t){return function(e,n,r){var a=Object(k.a)(o,i,e);return d(a)?Object(w.sample)(P):f(a)?y(t,n,r):a>=.7&&a<.8?Object(w.sample)(M):a>=.8?Object(w.sample)(I):Object(w.sample)(T)}},b=m(s),v=s.map((function(t,e){return t.map((function(t,n){return b(t,n,e)}))})),g=function(t){var e=t.x,n=t.y;if(n-1<0||e-1<0)return!1;var r=v[n-1][e-1],a=v[n-1][e],o=v[n][e-1],i=v[n][e],c=function(t){return Object(w.includes)(T,t)};return c(r)&&c(a)&&c(o)&&c(i)},O=v.flatMap((function(t,e){return t.map((function(t,n){return{x:n,y:e}}))})).filter(g),j=function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},A=function(t){var e=t.x,n=t.y;return v[n-1][e-1]=S[0],v[n-1][e]=S[1],v[n][e-1]=S[2],v[n][e]=S[3],{x:e,y:n}},E=function(t,e,n){return Object(w.every)(t,(function(t){return j(t,e)>n}))},L=function(t){return function(e,n){for(var r=Object(w.sample)(O),a=E(e,r,t);!a;)r=Object(w.sample)(O),a=E(e,r,t);return[].concat(Object(C.a)(e),[r])}},B=function(){var t=Object(w.range)(20).reduce(L(20),[]).map(A);return console.log(t.length),console.log(t),t};return B(),console.log("Min: ".concat(o,", Max: ").concat(i)),console.log("<0: ".concat(c,", >0: ").concat(u)),console.log("Seed: ".concat(n)),v}(100,100),100,100),e=t.map,n=t.finder,r=t.costMatrix,a=t.spawnPoint,o=t.terrainLayer;this.finder=n,this.terrainLayer=o;var i,c,u=e.tileWidth,s=e.tileHeight,l=(i=a.x-2,c=a.y+2,{x:Math.floor(128*i),y:Math.floor(128*c)}),h=this.addPlayer();this.target=h.addArmy(l.x,l.y,"warrior"),this.setupCamera(o.width,o.height),this.camera.centerOn(l.x,l.y),this.movement=z(this,r,u,s),this.createMapControls(),this.input.on("pointerdown",this.onPointerDown),this.scene.run("UI")}},{key:"update",value:function(t,e){this.controls.update(e),this.camera.setZoom(c.Math.Clamp(this.camera.zoom,.08,1)),this.players.forEach((function(t){return t.update()}))}},{key:"target",get:function(){return this.selectedTarget},set:function(t){this.selectedTarget=t,t?this.input.setDefaultCursor(H("cursor_move")):this.input.setDefaultCursor(H("cursor"))}}]),e}(A),W={physics:{default:"arcade",arcade:{debug:!0,gravity:{y:0}}},type:u.a.AUTO,width:800,height:600,parent:"App",pixelArt:!0,scene:[N,j]};new c.Game(W);var J=function(){return a.a.createElement("div",{className:"App",id:"App"})};i.a.render(a.a.createElement(J,null),document.getElementById("root"))},566:function(t,e,n){t.exports=n(1495)},571:function(t,e,n){},572:function(t,e,n){}},[[566,1,2]]]);
//# sourceMappingURL=main.8b5cd85a.chunk.js.map
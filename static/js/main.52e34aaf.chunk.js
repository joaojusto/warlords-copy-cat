(this.webpackJsonpwarlords_copy_cat=this.webpackJsonpwarlords_copy_cat||[]).push([[0],{1496:function(t,e,n){"use strict";n.r(e);var r=n(130),i=n.n(r),a=n(563),s=n.n(a),o=(n(572),n(573),n(32)),c=n.n(o),u=n(38),l=n(77),h=n(79),d=n(78),m=n(80),f=102,y=102,p=10,b=2,v=8772,g="minimap",O=function(t){function e(){return Object(u.a)(this,e),Object(h.a)(this,Object(d.a)(e).call(this,{key:"UI",active:!1}))}return Object(m.a)(e,t),Object(l.a)(e,[{key:"create",value:function(){var t=this.scene.get("GameScene");!function(t,e,n){var r=f,i=y,a=p,s=g,o=v,c=(i-b)/n,u={x:e/2,y:n/2},l={x:t.width-r-a,y:a};t.cameras.add(l.x,l.y,r,i).setZoom(c).setName(s).centerOn(u.x,u.y).setBackgroundColor(o)}(t,t.terrainLayer.width,t.terrainLayer.height);var e=t.players[0],n=this.add.text(20,20,"Current Player: ".concat(e.name(),", turn: ").concat(e.turn()),{fill:"#000000"});this.add.text(700,560,"End Turn",{fill:"#000000"}).setInteractive().on("pointerdown",(function(){t.target=null,t.movement.clear(),e.endTurn(),n.setText("Current Player: ".concat(e.name(),", turn: ").concat(e.turn()))})).on("pointerover",(function(){return t.setClickCursor()})).on("pointerout",(function(){return t.setDefaultCursor()}))}}]),e}(o.Scene),j=n(91),w=n(34),x=n(9),C={fill:"#000000",align:"center"},k=function(t){function e(){return Object(u.a)(this,e),Object(h.a)(this,Object(d.a)(e).call(this,{key:"Modal",active:!1}))}return Object(m.a)(e,t),Object(l.a)(e,[{key:"preload",value:function(){this.load.setBaseURL("".concat("/warlords-copy-cat")),this.load.image("modal","modal_bg.png")}},{key:"create",value:function(t){var e=this,n=t.castle.name;this.game=this.scene.get("GameScene"),this.castle=t.castle,this.player=t.player,this.armies=[],this.newArmy={},this.add.sprite(this.cameras.main.centerX,this.cameras.main.centerY,"modal"),this.title=this.add.text(this.cameras.main.centerX,100,n.charAt(0).toUpperCase()+n.slice(1),C).setOrigin(.5,.5),this.add.text(90,140,"Garrison",C),this.add.text(630,140,"New army",C),this.exit=this.add.text(660,490,"Close",C).setInteractive().on("pointerdown",(function(){e.scene.stop(),e.game.setDefaultCursor(),Object(x.isEmpty)(e.newArmy)||e.player.addArmy(e.castle.positon.x,e.castle.positon.y,"warrior"),e.game.scene.resume()}))}},{key:"update",value:function(){this.drawArmyList(),this.drawNewArmyList()}},{key:"drawNewArmyList",value:function(){var t=this;if(!Object(x.isEqual)(this.newArmy,this.previousNewArmy)){this.newArmyList&&this.newArmyList.forEach((function(t){return t.destroy()})),this.newLabelList&&this.newLabelList.forEach((function(t){return t.destroy()}));var e=1;this.newArmyList=Object(x.map)(this.newArmy,(function(n,r){var i=160+20*e;return e++,t.add.sprite(630,i,r)})),e=1,this.newLabelList=Object(x.map)(this.newArmy,(function(n){var r=155+20*e;return e++,t.add.text(650,r,"x".concat(n),C)})),this.previousNewArmy=this.newArmy}}},{key:"drawArmyList",value:function(){var t=this;if(!Object(x.isEqual)(this.armies,this.castle.armies)){this.armyList&&this.armyList.forEach((function(t){return t.destroy()})),this.labelList&&this.labelList.forEach((function(t){return t.destroy()})),this.buttonList&&this.buttonList.forEach((function(t){return t.destroy()}));var e=1;this.armyList=Object(x.map)(this.castle.armies,(function(n,r){var i=160+20*e;return e++,t.add.sprite(100,i,r)})),e=1,this.labelList=Object(x.map)(this.castle.armies,(function(n){var r=155+20*e;return e++,t.add.text(120,r,"x".concat(n),C)})),e=1,this.buttonList=Object(x.map)(this.castle.armies,(function(n,r){var i=155+20*e;return e++,t.add.text(200,i,"----\x3e",C).setInteractive().on("pointerdown",(function(){n<=0||(t.castle.removeArmy(r,1),t.newArmy=Object(w.a)({},t.newArmy,Object(j.a)({},r,(t.newArmy[r]||0)+1)))}))})),this.armies=this.castle.armies}}}]),e}(o.Scene),A=n(43),L=n(564),T=n(48),M=[2],E=[4,5,6],D=[8,9,10,11,12,13,14,15],S=[16,17,24,25],I=[1],P=[3,7],B=function(t){function e(){return Object(u.a)(this,e),Object(h.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(m.a)(e,t),Object(l.a)(e,[{key:"createMapControls",value:function(){var t=o.Input.Keyboard.KeyCodes,e=t.Q,n=t.E,r=o.Cameras.Controls.SmoothedKeyControl,i=this.input.keyboard.createCursorKeys(),a=i.left,s=i.right,c={up:i.up,down:i.down,left:a,right:s,camera:this.camera,zoomIn:this.keyboard.addKey(e),zoomOut:this.keyboard.addKey(n),drag:.6,maxSpeed:200,acceleration:2.8};this.controls=new r(c)}},{key:"setupCamera",value:function(t,e){var n=this.camera,r=n.width,i=n.height;this.camera.setBounds(0,0,t,e),this.camera.setScroll(-r/2+t/2,-i/2+e/2)}},{key:"controls",get:function(){return this.mapControls},set:function(t){this.mapControls=t}},{key:"camera",get:function(){return this.cameras.main}},{key:"keyboard",get:function(){return this.input.keyboard}},{key:"width",get:function(){return this.game.config.width}},{key:"height",get:function(){return this.game.config.height}},{key:"finder",get:function(){return this.pathFinder},set:function(t){this.pathFinder=t}},{key:"movement",get:function(){return this.entityMover},set:function(t){this.entityMover=t}},{key:"minimap",get:function(){return this.minimapCamera},set:function(t){this.minimapCamera=t}},{key:"terrainLayer",get:function(){return this.terrain},set:function(t){this.terrain=t}}]),e}(o.Scene),z=n(565),G=n.n(z),N=n(566),_=function t(e,n,r,i,a){var s=this;Object(u.a)(this,t),this.setOwner=function(t){s.owner=t.name},this.clearOwner=function(){s.owner=null},this.addArmy=function(t,e){var n=s.armies[t]||0;s.armies=Object(w.a)({},s.armies,Object(j.a)({},t,n+e))},this.removeArmy=function(t,e){if(s.armies[t]){var n=s.armies[t];s.armies=Object(w.a)({},s.armies,Object(j.a)({},t,n-e))}},this.scene=e,this.name=Object(N.a)(),this.positon={x:n*i+i,y:r*i+a},this.size={x:2*i+i/2,y:2*a+a/2},this.trigger=e.add.zone(this.positon.x,this.positon.y).setSize(this.size.x,this.size.y),e.physics.world.enable(this.trigger),this.trigger.body.setAllowGravity(!1),this.trigger.body.moves=!1,this.trigger.setInteractive(),this.trigger.on("pointerover",(function(){return e.setOpenCursor()})),this.trigger.on("pointerout",(function(){return e.setDefaultCursor()})),this.trigger.on("pointerdown",(function(){return e.events.emit("castleclicked",s)})),this.armies={warrior:2}},U={path:[],cost:0,totalCost:0,currentTurn:[],nextTurns:[],indicators:[],nextIndicators:[]},K=function(t,e,n,r){var i=t.add.graphics(),a=U,s=function(t){return t*n},c=function(t){return t*r},u=function(){i.destroy(),i=t.add.graphics(),a=U},l=function(t){var e=t.x,a=t.y,u={x:s(e)+n/2,y:c(a)+r/2},l=new o.Geom.Circle(u.x,u.y,8);return i.fillCircleShape(l),l},h=function(e){return function(){t.camera.stopFollow(e.body),u()}};return{move:function(n){return function(r){if(!r||r.length<=1)return u();if(a&&a.currentTurn.length&&Object(x.isEqual)(a.path,r))return function(e){var n=a,r=n.cost,i=n.currentTurn.map((function(t){var n=t.x,r=t.y;return{targets:e.body,x:{value:s(n),duration:200},y:{value:c(r),duration:200}}}));t.camera.startFollow(e.body),t.tweens.timeline({tweens:i,onComplete:h(e)}),e.spendMovement(r)}(n);u();var o=r.slice(1,r.length).reduce(function(t,e){return function(n,r){var i=r.x,a=r.y,s=n.cost,o=n.totalCost,c=n.currentTurn,u=n.nextTurns,l=t[a][i];return o+l<=e.movementPoints?Object(w.a)({},n,{cost:s+l,totalCost:o+l,currentTurn:[].concat(Object(A.a)(c),[{x:i,y:a}])}):Object(w.a)({},n,{totalCost:o+l,nextTurns:[].concat(Object(A.a)(u),[{x:i,y:a}])})}}(e,n),Object(w.a)({},U,{path:r})),d=o.currentTurn,m=o.nextTurns;i.fillStyle(16777215,1),o.indicators=d.map(l),i.fillStyle(16711680,1),o.nextIndicators=m.map(l),a=o}},clear:u}},F=function t(e,n,r,i){var a=this;Object(u.a)(this,t),this.spendMovement=function(t){return a.movementPoints-=t},this.resetMovement=function(){return a.movementPoints=4},this.update=function(){var t=a.body.body;t.embedded&&(t.touching.none=!1);var e=!t.touching.none,n=!t.wasTouching.none;e&&!n?a.body.emit("overlapstart"):!e&&n&&a.body.emit("overlapend")},this.scene=e,this.movementPoints=4,this.body=e.physics.add.sprite(n,r,i).setDisplaySize(64,64).setDisplayOrigin(-16,-10).setInteractive().on("pointerdown",(function(){return e.target=a})),this.onCastle=!1,this.body.on("overlapstart",(function(){this.body.debugBodyColor=16724736,this.onCastle=!0,alert("You're on a castle")})),this.body.on("overlapend",(function(){this.body.debugBodyColor=65331,this.onCastle=!1})),this.scene.castles.forEach((function(t){var e=t.trigger;a.scene.physics.add.overlap(a.body,e)}))},q={turn:1,name:"",money:0,armies:[],castles:[]},H=function(t,e){var n=Object(w.a)({},q,{name:"Player ".concat(e)});return{state:n,name:function(){return n.name},turn:function(){return n.turn},update:function(){return n.armies.forEach((function(t){return t.update()}))},endTurn:function(){n.armies.forEach((function(t){return t.resetMovement()})),n=Object(w.a)({},n,{turn:n.turn+1})},addArmy:function(e,r,i){var a=new F(t,e,r,i);return n=Object(w.a)({},n,{armies:[].concat(Object(A.a)(n.armies),[a])}),a}}},W=function(t,e){return{x:Math.floor(t/128),y:Math.floor(e/128)}},X=function(t){return"url(".concat("/warlords-copy-cat","/").concat(t,".png), pointer")},Y=function(t){function e(){var t;return Object(u.a)(this,e),(t=Object(h.a)(this,Object(d.a)(e).call(this,"GameScene"))).onPointerDown=function(e){if(e.rightButtonDown()&&(t.target=null),t.target){var n=e.worldX,r=e.worldY,i=W(n,r),a=W(t.target.body.x,t.target.body.y),s=t.movement.move(t.target);try{t.finder.findPath(a.x,a.y,i.x,i.y,s),t.finder.calculate()}catch(o){console.error("Ups! Out of scope :S")}}},t.players=[],t}return Object(m.a)(e,t),Object(l.a)(e,[{key:"setClickCursor",value:function(){this.input.setDefaultCursor(X("cursor"))}},{key:"setOpenCursor",value:function(){this.input.setDefaultCursor(X("cursor_open"))}},{key:"setDefaultCursor",value:function(){this.target?this.input.setDefaultCursor(X("cursor_move")):this.input.setDefaultCursor(X("cursor"))}},{key:"addPlayer",value:function(){var t=this.players.length,e=H(this,t);return this.players.push(e),e}},{key:"preload",value:function(){this.load.setBaseURL("".concat("/warlords-copy-cat")),this.load.image("tileset","tilesets/tileset-extruded.png"),this.load.image("warrior","warrior.png")}},{key:"create",value:function(){var t=this;this.input.setDefaultCursor(X("cursor")),this.input.mouse.disableContextMenu();var e=function(t,e,n,r){var i,a=t.make.tilemap({tileWidth:128,tileHeight:128}),s=a.tileWidth,o=a.tileHeight,c=a.addTilesetImage("tileset","tileset",s,o,1,2),u=a.createBlankDynamicLayer("terrain",c,0,0,n,r),l=a.createBlankDynamicLayer("object",c,0,0,n,r),h=new G.a.js;h.setGrid(e),h.setAcceptableTiles([].concat(Object(A.a)(M),Object(A.a)(I),Object(A.a)(E))),h.enableDiagonals();var d=[],m=function(t,e){return function(n,r,i,a){e.setTileCost(n,a),t[i]=t[i]||[],t[i][r]=a}}(d,h);return t.castles=[],e.forEach((function(e,n){return e.forEach((function(e,r){if(Object(x.includes)(S,e)){if(u.putTileAt(M[0],r,n),l.putTileAt(e,r,n),e===S[0]){var a=new _(t,r,n,s,o);!i&&Object(x.includes)(S,e)&&(i={x:r,y:n,castle:a}),t.castles.push(a)}}else u.putTileAt(e,r,n);Object(x.includes)(M,e)&&m(e,r,n,1),Object(x.includes)(E,e)&&m(e,r,n,2),Object(x.includes)(I,e)&&m(e,r,n,3)}))})),u=a.convertLayerToStatic(u),(l=a.convertLayerToStatic(l)).setTileIndexCallback(24,(function(){return console.log("here 24")}),t),l.setTileIndexCallback(25,(function(){return console.log("here 25")}),t),t.objectLayer=l,{map:a,finder:h,costMatrix:d,spawnPoint:i,terrainLayer:u}}(this,function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.random(),r=new L.Noise;r.seed(n);var i=12*t/100,a=0,s=0,o=0,c=0,u=Object(x.range)(e).map((function(e){return Object(x.range)(t).map((function(t){var n=r.perlin2(t/i,e/i);return a=n<a?n:a,s=n>s?n:s,n<0?o++:c++,n}))})),l=.45,h=l+.1,d=function(t){return t>=l&&t<h},m=function(t){return t<l},f=function(t){return!d(t)&&!m(t)},y=function(t,e,n){if(n-1<0||n+1>=t.length)return Object(x.sample)(P);if(e-1<0||e+1>=t.length)return Object(x.sample)(P);var r=Object(T.a)(a,s,t[n-1][e-1]),i=Object(T.a)(a,s,t[n-1][e]),o=Object(T.a)(a,s,t[n-1][e+1]),c=Object(T.a)(a,s,t[n][e-1]),u=Object(T.a)(a,s,t[n][e+1]),h=Object(T.a)(a,s,t[n+1][e-1]),d=Object(T.a)(a,s,t[n+1][e]),m=Object(T.a)(a,s,t[n+1][e+1]);return f(i)||f(c)||f(u)||f(d)?f(d)&&f(u)?D[7]:f(i)&&f(u)?D[2]:f(d)&&f(c)?D[5]:f(i)&&f(c)?D[0]:f(i)?D[1]:f(d)?D[6]:f(u)?D[3]:f(c)?D[4]:r<l&&i<l&&o<l?D[6]:h<l&&d<l&&m<l?D[1]:void 0:Object(x.sample)(P)},p=function(t){return function(e,n,r){var i=Object(T.a)(a,s,e);return m(i)?Object(x.sample)(P):d(i)?y(t,n,r):i>=.7&&i<.8?Object(x.sample)(E):i>=.8?Object(x.sample)(I):Object(x.sample)(M)}},b=p(u),v=u.map((function(t,e){return t.map((function(t,n){return b(t,n,e)}))})),g=function(t){var e=t.x,n=t.y;if(n-1<0||e-1<0)return!1;var r=v[n-1][e-1],i=v[n-1][e],a=v[n][e-1],s=v[n][e],o=function(t){return Object(x.includes)(M,t)};return o(r)&&o(i)&&o(a)&&o(s)},O=v.flatMap((function(t,e){return t.map((function(t,n){return{x:n,y:e}}))})).filter(g),j=function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},w=function(t){var e=t.x,n=t.y;return v[n-1][e-1]=S[0],v[n-1][e]=S[1],v[n][e-1]=S[2],v[n][e]=S[3],{x:e,y:n}},C=function(t,e,n){return Object(x.every)(t,(function(t){return j(t,e)>n}))},k=function(t){return function(e,n){for(var r=Object(x.sample)(O),i=C(e,r,t);!i;)r=Object(x.sample)(O),i=C(e,r,t);return[].concat(Object(A.a)(e),[r])}},B=function(){var t=Object(x.range)(20).reduce(k(20),[]).map(w);return console.log(t.length),console.log(t),t};return B(),console.log("Min: ".concat(a,", Max: ").concat(s)),console.log("<0: ".concat(o,", >0: ").concat(c)),console.log("Seed: ".concat(n)),v}(100,100),100,100),n=e.map,r=e.finder,i=e.costMatrix,a=e.spawnPoint,s=e.terrainLayer;this.finder=r,this.terrainLayer=s;var o,c,u=n.tileWidth,l=n.tileHeight,h=(o=a.x-2,c=a.y+2,{x:Math.floor(128*o),y:Math.floor(128*c)}),d=this.addPlayer();a.castle.setOwner(d),this.target=d.addArmy(h.x,h.y,"warrior"),this.setupCamera(s.width,s.height),this.camera.centerOn(h.x,h.y),this.movement=K(this,i,u,l),this.createMapControls(),this.input.on("pointerdown",this.onPointerDown),this.scene.run("UI"),this.events.on("castleclicked",(function(e){t.setClickCursor(),t.scene.pause(),t.scene.run("Modal",{castle:e,player:d})}))}},{key:"update",value:function(t,e){this.controls.update(e),this.camera.setZoom(o.Math.Clamp(this.camera.zoom,.08,1)),this.players.forEach((function(t){return t.update()}))}},{key:"target",get:function(){return this.selectedTarget},set:function(t){this.selectedTarget=t,t?this.input.setDefaultCursor(X("cursor_move")):this.input.setDefaultCursor(X("cursor"))}}]),e}(B),J={physics:{default:"arcade",arcade:{debug:!0,gravity:{y:0}}},type:c.a.AUTO,width:800,height:600,parent:"App",pixelArt:!0,scene:[Y,O,k]};new o.Game(J);var R=function(){return i.a.createElement("div",{className:"App",id:"App"})};s.a.render(i.a.createElement(R,null),document.getElementById("root"))},567:function(t,e,n){t.exports=n(1496)},572:function(t,e,n){},573:function(t,e,n){}},[[567,1,2]]]);
//# sourceMappingURL=main.52e34aaf.chunk.js.map